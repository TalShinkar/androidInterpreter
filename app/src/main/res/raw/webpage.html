<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
        <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        <style type="text/css">
			body {
				margin: 0px;
				padding: 0px;
				height: 99%;
				background-color: black;
			}
			textarea#setter  {
				left: -1000px;
				position: absolute;
			}
			.cursor {
				font-size: 12px;
				background-color: white;
				color: white;
				position: relative;
			}
			#terminal {
				margin: 8px;
				cursor: text;
				height: 500px;
				overflow: auto;
			}
			#writer {
				font-family: cursor, courier;
				color: white;
			}
	        #getter {
	            margin: 5px;
	        }
		</style>
    </head>
    <body>
        <div id="terminal">
            <textarea type="text" id="setter"></textarea>
            <div id="getter">
                <font color="#00c500" style="font-family: cursor, courier;font-weight: bold;">android@phone</font>
                <font color="white" style="font-family: cursor, courier;font-weight: bold;"> :</font>
                <font color="cyan" style="font-family: cursor, courier;font-weight: bold;"> ></font>
                <span id="writer"></span><b class="cursor" id="cursor">&nbsp</b>
            </div>
        </div>
        <script type="text/javascript">
        var cursor = $("#cursor");
		var setter = $("#setter");
		var writer = $("#writer");
		var terminal = $("#terminal");
		window.addEventListener("keydown",
		function(e){
		    if ([8].indexOf(e.keyCode) > -1 && setter[0].value[setter[0].value.length-1] == "\n")
    		    e.preventDefault();
			if([37,38,39,40].indexOf(e.keyCode) > -1)
				e.preventDefault();
		},false);

		$(cursor).css("left", "0px");
		function runscript(code){
		    var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(writer);
                    setter[0].value = setter[0].value.substring(0, setter[0].value.length - 1) + '<br>';
                    setter[0].value +=  this.responseText;
                    writer.html(nl2br(setter[0].value));
                }
            };
            xhttp.open("GET", "?code=" + code, true);
            xhttp.send();
		}

		function nl2br(txt){
			return txt.replace(/\n/g, '<br />'+
			'<font color="#00c500" style="font-family: cursor, courier;font-weight: bold;">android@phone</font>'+
			'<font color="white" style="font-family: cursor, courier;font-weight: bold;"> :</font>'+
			'<font color="cyan" style="font-family: cursor, courier;font-weight: bold;"> \> </font>');
		}
		function writeit(from, e){
			if(e.originalEvent.key == "Enter"){
			    enter_pos = from.value.length - 1;
			    console.log("enter pos is " + enter_pos);
			    all_code = from.value.substring(0, enter_pos)
			    console.log("all code is:");
			    console.log(all_code);
			    console.log("----END----");
			    new_code_start = all_code.lastIndexOf('\n') + 1;
			    console.log("new code pos is " + new_code_start);
			    new_code = all_code.substring(new_code_start)
			    console.log("new code is:");
			    console.log(new_code);
			    console.log("----END----");
			    runscript(new_code)
			}
			else{
			e = e || window.event;
			var w = $(writer);
			var tw = from.value;
			w.html(nl2br(tw));
			}
		}
        function blink(){
            if($(cursor).css("display") == "none"){
                $(cursor).css("display","inline");
            } else {
            	$(cursor).css("display","none");
            }
        }
        setInterval("blink()", 500);
        $(terminal).click(function(){
        	$(setter).focus();
        });
		$(setter).keyup(function(event){
			writeit(this, event);
		});
	</script>
    </body>
</html>